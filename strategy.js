'use strict';const a10_0x18cfc7=a10_0x594a;function a10_0x23d7(){const _0x11b46d=['Address\x20is\x20required','10xKWVaa','failWithChallenge','responseField','586620OSOQTz','2646882fjvqey','baseCryptoAuth','address','crypto','verifyResponse','BadRequestException','getChallenge','walletVerifier','PublicException','success','1442pQGnOu','cryptoAuthFactory','message','6806063cpxWZP','Strategy','res','x-wallet-type','walletType','1146FxTZFe','6416xpqkRF','3769735DtjNyV','name','1443024AgIAQO','getBaseCryptoAuth','./crypto/constants','status','6eltXUM','./crypto/base','values','Invalid\x20credentials','./crypto/factory','headers','string','response','6083Eyegag','object','Invalid\x20wallet\x20type','body','authenticate','__esModule','assert'];a10_0x23d7=function(){return _0x11b46d;};return a10_0x23d7();}(function(_0x49c0b9,_0x2acd7e){const _0x51d752=a10_0x594a,_0x5d5721=_0x49c0b9();while(!![]){try{const _0x20ffc3=-parseInt(_0x51d752(0xcd))/0x1*(parseInt(_0x51d752(0xd5))/0x2)+parseInt(_0x51d752(0xd9))/0x3+-parseInt(_0x51d752(0xc2))/0x4+parseInt(_0x51d752(0xd7))/0x5*(parseInt(_0x51d752(0xdd))/0x6)+-parseInt(_0x51d752(0xe5))/0x7*(-parseInt(_0x51d752(0xd6))/0x8)+-parseInt(_0x51d752(0xc3))/0x9*(-parseInt(_0x51d752(0xbf))/0xa)+-parseInt(_0x51d752(0xd0))/0xb;if(_0x20ffc3===_0x2acd7e)break;else _0x5d5721['push'](_0x5d5721['shift']());}catch(_0x589182){_0x5d5721['push'](_0x5d5721['shift']());}}}(a10_0x23d7,0x9ade1));Object['defineProperty'](exports,a10_0x18cfc7(0xea),{'value':!![]}),exports[a10_0x18cfc7(0xd1)]=void 0x0;const passport_strategy_1=require('passport-strategy'),factory_1=require(a10_0x18cfc7(0xe1)),base_1=require(a10_0x18cfc7(0xde)),assert=require(a10_0x18cfc7(0xeb)),constants_1=require(a10_0x18cfc7(0xdb)),validateWalletType=_0x4a01fc=>typeof _0x4a01fc==='string'&&Object[a10_0x18cfc7(0xdf)](constants_1['WalletType'])['includes'](_0x4a01fc);function a10_0x594a(_0x2f4abf,_0xebf08a){const _0x23d725=a10_0x23d7();return a10_0x594a=function(_0x594a76,_0x2c8cb2){_0x594a76=_0x594a76-0xbe;let _0x43aa61=_0x23d725[_0x594a76];return _0x43aa61;},a10_0x594a(_0x2f4abf,_0xebf08a);}class CryptoStrategy extends passport_strategy_1['Strategy']{constructor(_0x33cec8={}){const _0x1ff28c=a10_0x18cfc7;super(),this[_0x1ff28c(0xd8)]=_0x1ff28c(0xc6),this[_0x1ff28c(0xce)]=new factory_1['CryptoAuthFactory'](),this[_0x1ff28c(0xc4)]=this[_0x1ff28c(0xce)][_0x1ff28c(0xda)](),this[_0x1ff28c(0xc1)]=_0x33cec8[_0x1ff28c(0xc1)]||_0x1ff28c(0xe4);}async[a10_0x18cfc7(0xc9)](_0x37af42){const _0xbfa697=a10_0x18cfc7,_0x56e100=_0x37af42[_0xbfa697(0xe2)]['x-address'],_0x25683a=_0x37af42[_0xbfa697(0xe2)][_0xbfa697(0xd3)]||constants_1['WalletType']['EVM'];assert(validateWalletType(_0x25683a),new base_1[(_0xbfa697(0xc8))](_0xbfa697(0xe7)));if(typeof _0x56e100!==_0xbfa697(0xe3))throw new base_1[(_0xbfa697(0xcb))](_0xbfa697(0xbe));const _0x3e59aa=this[_0xbfa697(0xce)][_0xbfa697(0xca)](_0x25683a);return _0x3e59aa['generateChallenge']({'address':_0x56e100});}async['verifyResponse'](_0x855141,_0x2221e3){const _0x4e7bef=a10_0x18cfc7;assert(validateWalletType(_0x2221e3[_0x4e7bef(0xd4)]),new base_1['BadRequestException'](_0x4e7bef(0xe7)));const _0xfb46f4=this[_0x4e7bef(0xce)]['walletVerifier'](_0x2221e3[_0x4e7bef(0xd4)]),_0x589d5d=await _0xfb46f4[_0x4e7bef(0xc7)](_0x2221e3);return{'status':_0x589d5d[_0x4e7bef(0xdc)],'user':_0x589d5d['status']?{'address':_0x589d5d[_0x4e7bef(0xc5)]}:undefined};}async[a10_0x18cfc7(0xe9)](_0x3e69b5){const _0x5cd0fa=a10_0x18cfc7,_0x51fa62=_0x3e69b5[_0x5cd0fa(0xe8)]||{},_0x444ad9=_0x51fa62[this['responseField']];if(!_0x444ad9||typeof _0x444ad9!==_0x5cd0fa(0xe6)){const _0x478d5f=await this[_0x5cd0fa(0xc9)](_0x3e69b5);return this[_0x5cd0fa(0xc0)](_0x3e69b5,'Challenge',_0x478d5f);}try{const {user:_0x211aa9,status:_0x33d64c}=await this[_0x5cd0fa(0xc7)](_0x3e69b5,_0x444ad9);if(_0x33d64c&&_0x211aa9)return this[_0x5cd0fa(0xcc)](_0x211aa9);return this[_0x5cd0fa(0xc0)](_0x3e69b5,_0x5cd0fa(0xe0));}catch(_0xe7826a){if(_0xe7826a instanceof base_1[_0x5cd0fa(0xcb)])return this[_0x5cd0fa(0xc0)](_0x3e69b5,_0xe7826a[_0x5cd0fa(0xcf)]);throw _0xe7826a;}}async[a10_0x18cfc7(0xc0)](_0x232b5c,_0x3e40f8,_0x29111a){const _0x4125fc=a10_0x18cfc7;return _0x232b5c[_0x4125fc(0xd2)]['status'](0x191)['json']({'challenge':_0x29111a,'message':_0x3e40f8||'Unauthorized'});}}exports['Strategy']=CryptoStrategy,exports['default']=CryptoStrategy;