'use strict';const a10_0x5b338e=a10_0x35cb;function a10_0x506b(){const _0x5337f9=['status','464476HdpzwH','9uOsiDl','string','Strategy','verifyResponse','./crypto/factory','passport-strategy','includes','BadRequestException','Unauthorized','2222616iSTsCJ','cryptoAuthFactory','json','baseCryptoAuth','30sSSxCw','message','Invalid\x20wallet\x20type','default','6220720bDXDPJ','3416632OBNjyn','3698538PdmgNU','walletType','PublicException','body','CryptoAuthFactory','assert','success','./crypto/base','getChallenge','authenticate','name','responseField','Invalid\x20credentials','Challenge','failWithChallenge','48QjCdEC','WalletType','1KvExtO','462yyMGfi','./crypto/constants','10850500ERkyNM','walletVerifier'];a10_0x506b=function(){return _0x5337f9;};return a10_0x506b();}function a10_0x35cb(_0x5dea5b,_0x4f2880){const _0x506b44=a10_0x506b();return a10_0x35cb=function(_0x35cb82,_0x32812f){_0x35cb82=_0x35cb82-0x72;let _0x5565b6=_0x506b44[_0x35cb82];return _0x5565b6;},a10_0x35cb(_0x5dea5b,_0x4f2880);}(function(_0x191088,_0x3513b9){const _0x2ea23d=a10_0x35cb,_0x24476b=_0x191088();while(!![]){try{const _0x32656b=-parseInt(_0x2ea23d(0x85))/0x1*(parseInt(_0x2ea23d(0x95))/0x2)+parseInt(_0x2ea23d(0x74))/0x3+parseInt(_0x2ea23d(0x8b))/0x4*(-parseInt(_0x2ea23d(0x99))/0x5)+parseInt(_0x2ea23d(0x83))/0x6*(parseInt(_0x2ea23d(0x86))/0x7)+parseInt(_0x2ea23d(0x73))/0x8*(-parseInt(_0x2ea23d(0x8c))/0x9)+parseInt(_0x2ea23d(0x88))/0xa+parseInt(_0x2ea23d(0x72))/0xb;if(_0x32656b===_0x3513b9)break;else _0x24476b['push'](_0x24476b['shift']());}catch(_0x252bbd){_0x24476b['push'](_0x24476b['shift']());}}}(a10_0x506b,0x9e68b));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a10_0x5b338e(0x8e)]=void 0x0;const passport_strategy_1=require(a10_0x5b338e(0x91)),factory_1=require(a10_0x5b338e(0x90)),base_1=require(a10_0x5b338e(0x7b)),assert=require(a10_0x5b338e(0x79)),constants_1=require(a10_0x5b338e(0x87)),validateWalletType=_0x15e91c=>typeof _0x15e91c===a10_0x5b338e(0x8d)&&Object['values'](constants_1[a10_0x5b338e(0x84)])[a10_0x5b338e(0x92)](_0x15e91c);class CryptoStrategy extends passport_strategy_1[a10_0x5b338e(0x8e)]{constructor(_0x805905={}){const _0x1b9eb3=a10_0x5b338e;super(),this[_0x1b9eb3(0x7e)]='crypto',this['cryptoAuthFactory']=new factory_1[(_0x1b9eb3(0x78))](),this[_0x1b9eb3(0x98)]=this[_0x1b9eb3(0x96)]['getBaseCryptoAuth'](),this[_0x1b9eb3(0x7f)]=_0x805905[_0x1b9eb3(0x7f)]||'response';}async[a10_0x5b338e(0x7c)](_0x98b26e){const _0x484991=a10_0x5b338e,_0xd2e0e7=_0x98b26e['headers']['x-address'],_0x39b543=_0x98b26e['headers']['x-wallet-type']||constants_1[_0x484991(0x84)]['EVM'];assert(validateWalletType(_0x39b543),new base_1[(_0x484991(0x93))](_0x484991(0x9b)));if(typeof _0xd2e0e7!==_0x484991(0x8d))throw new base_1[(_0x484991(0x76))]('Address\x20is\x20required');const _0x212264=this[_0x484991(0x96)][_0x484991(0x89)](_0x39b543);return _0x212264['generateChallenge']({'address':_0xd2e0e7});}async[a10_0x5b338e(0x8f)](_0x2a7306,_0x281930){const _0x54af96=a10_0x5b338e;assert(validateWalletType(_0x281930[_0x54af96(0x75)]),new base_1[(_0x54af96(0x93))](_0x54af96(0x9b)));const _0x2c3d59=this['cryptoAuthFactory'][_0x54af96(0x89)](_0x281930['walletType']),_0x2908cf=await _0x2c3d59[_0x54af96(0x8f)](_0x281930);return{'status':_0x2908cf[_0x54af96(0x8a)],'user':_0x2908cf['status']?{'address':_0x2908cf['address']}:undefined};}async[a10_0x5b338e(0x7d)](_0x3d21a1){const _0x3795b9=a10_0x5b338e,_0xd15446=_0x3d21a1[_0x3795b9(0x77)]||{},_0x20d010=_0xd15446[this[_0x3795b9(0x7f)]];try{if(!_0x20d010||typeof _0x20d010!=='object'){const _0x5ad0ce=await this['getChallenge'](_0x3d21a1);return this[_0x3795b9(0x82)](_0x3d21a1,_0x3795b9(0x81),_0x5ad0ce);}const {user:_0x436f0,status:_0x346a30}=await this[_0x3795b9(0x8f)](_0x3d21a1,_0x20d010);if(_0x346a30&&_0x436f0)return this[_0x3795b9(0x7a)](_0x436f0);return this[_0x3795b9(0x82)](_0x3d21a1,_0x3795b9(0x80));}catch(_0xedf5a7){if(_0xedf5a7 instanceof base_1['PublicException'])return this[_0x3795b9(0x82)](_0x3d21a1,_0xedf5a7[_0x3795b9(0x9a)]);throw _0xedf5a7;}}async['failWithChallenge'](_0x1b4cc1,_0x2d5bf5,_0x5dcffd){const _0x56475f=a10_0x5b338e;return _0x1b4cc1['res'][_0x56475f(0x8a)](0x191)[_0x56475f(0x97)]({'challenge':_0x5dcffd,'message':_0x2d5bf5||_0x56475f(0x94)});}}exports[a10_0x5b338e(0x8e)]=CryptoStrategy,exports[a10_0x5b338e(0x9c)]=CryptoStrategy;